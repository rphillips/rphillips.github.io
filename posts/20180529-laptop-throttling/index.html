<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Laptop Throttling
        
    </title><meta content="Laptop Throttling" property=og:title><link href=https://trolocsis.com/fonts.css rel=stylesheet><script src=https://trolocsis.com/js/codeblock.js></script><script src=https://trolocsis.com/js/toc.js></script><script>MathJax={tex:{inlineMath:[[`\$`,`\$`],[`\\\\(`,`\\\\)`]]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Ryan's Blog" href=https://trolocsis.com/atom.xml rel=alternate type=application/atom+xml><link href=https://trolocsis.com/theme/light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://trolocsis.com/theme/dark.css rel=stylesheet><script src=https://trolocsis.com/js/themetoggle.js></script><script>if(window.matchMedia(`(prefers-color-scheme: dark)`).matches){setTheme(`dark`)}else{setTheme(`light`)}</script><link href=https://trolocsis.com/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://trolocsis.com>Ryan's Blog</a><div class=socials><a class=social href=https://github.com/rphillips rel=me> <img alt=github src=https://trolocsis.com/social_icons/github.svg> </a></div></div><nav><a href=https://trolocsis.com/posts style=margin-left:.5em>/posts</a><a href=https://trolocsis.com/about style=margin-left:.5em>/about</a><a href=https://trolocsis.com/tags style=margin-left:.5em>/tags</a></nav></header><main><article><div class=title><div class=page-header>Laptop Throttling<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2018-05-29</time><span class=tags-label> :: Tags:</span><span class=tags> <a class=post-tag href=https://trolocsis.com/tags/laptop/>laptop</a> </span></div></div><section class=body><p>I installed Fedora 28 and Archlinux onto my development machine; a Lenovo Thinkpad t470s. Generally both distributions ran perfectly fine, but I did run into a problem on battery power. On battery power my CPUs would not go over 800 Mhz. By plugging in the laptop the CPUs would spin up to their usual 3 Ghz rating.<p>Then I found this archlinux power management throttling article <a href=https://wiki.archlinux.org/index.php/Lenovo_ThinkPad_X1_Carbon_(Gen_6)#Power_management.2FThrottling_issues>Lenovo_ThinkPad_X1_Carbon_(Gen_6)#Power_management.2FThrottling_issues</a>. Exactly what I was seeing, but on the t470s.<p>I installed msr-tools and modprobed the module:<pre class=language-sh data-lang=sh style=color:#bfbab0;background-color:#0f1419><code class=language-sh data-lang=sh><span style=color:#ffb454>pacman</span><span style=color:#f29718> -S</span><span> msr-tools
</span><span style=color:#ffb454>modprobe</span><span> msr
</span></code></pre><p>Then ran the wrmsr utility to set the CPU registers manually:<pre class=language-sh data-lang=sh style=color:#bfbab0;background-color:#0f1419><code class=language-sh data-lang=sh><span style=color:#ffb454>wrmsr</span><span style=color:#f29718> -a</span><span> 0x1a2 0x3000000 </span><span style=color:#5c6773;font-style:italic># which sets the offset to 3 C, so the new trip point is 97 C 
</span></code></pre><p>While on battery power, the CPUs are scaling to their correct clock frequencies. I suspect this might be a bios issue, since it is happening on the X1 Carbon <em>and</em> the t470s.</section></article></main></div>